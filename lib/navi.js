(function(){function a(b,c){if("function"==typeof c){var e=new d(b);for(var f=1;f<arguments.length;++f)a.callbacks.push(e.middleware(arguments[f]))}else"string"==typeof b?a.show(b,c):a.start(b)}function b(b){b.init||(a.stop(),window.location=b.path)}function c(a,b){this.path=a,this.title=document.title,this.state=b||{},this.state.path=a,this.params=[]}function d(a,b){b=b||{},this.path=a,this.method="GET",this.regexp=e(a,this.keys=[],b.sensitive,b.strict)}function e(a,b,c,d){return a instanceof RegExp?a:(a instanceof Array&&(a="("+a.join("|")+")"),a=a.concat(d?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push({name:e,optional:!!g}),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+a+"$",c?"":"i"))}function f(b){if(b.state){var c=b.state.path;a.replace(c,b.state)}else a.show(location.pathname,null,!0)}function g(b){var c=b.target;while(c&&"A"!=c.nodeName)c=c.parentNode;if(!c||"A"!=c.nodeName)return;var d=c.getAttribute("href")||"";if(i(d)&&!h(d))return;b.preventDefault(),a.show(d)}function h(a){return 0==a.indexOf(location.origin)}function i(a){return~a.indexOf("://")}a.callbacks=[],a.start=function(a){a=a||{},!1!==a.popstate&&addEventListener("popstate",f,!1),!1!==a.click&&addEventListener("click",g,!1)},a.stop=function(){removeEventListener("click",g,!1),removeEventListener("popstate",f,!1)},a.show=function(b,d,e){var f=new c(b,d);f.init=e,a.dispatch(f),history.pushState(f.state,f.title,b)},a.replace=function(b,d,e){var f=new c(b,d);f.init=e,a.dispatch(f),history.replaceState(f.state,f.title,b)},a.dispatch=function(c){function e(){var f=a.callbacks[d++];if(!f)return b(c);f(c,e)}var d=0;e()},c.prototype.save=function(){history.replaceState(this.state,this.title,this.path)},d.prototype.middleware=function(a){var b=this;return function(c,d){if(b.match(c.path,c.params))return a(c,d);d()}},d.prototype.match=function(a,b){var c=this.keys,d=this.regexp.exec(a);if(!d)return!1;for(var e=1,f=d.length;e<f;++e){var g=c[e-1],h="string"==typeof d[e]?decodeURIComponent(d[e]):d[e];g?b[g.name]=undefined!==b[g.name]?b[g.name]:h:b.push(h)}return!0},window.page=a})();var __t;__t=function(ns){var curr,index,part,parts,_i,_len;curr=null,parts=[].concat=ns.split(".");for(index=_i=0,_len=parts.length;_i<_len;index=++_i){part=parts[index];if(curr===null){curr=eval(part);continue}curr[part]==null?curr=curr[part]={}:curr=curr[part]}return curr};var navi={};((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=this;__t("navi").PubSub=function(){function b(){}var a;return a=[],b.prototype.bind=function(b,c){return a.push({event:b,callback:c})},b.prototype.trigger=function(b){var c,d,e,f;f=[];for(d=0,e=a.length;d<e;d++)c=a[d],c.event===b?f.push(c.callback()):f.push(void 0);return f},b.prototype.unbind=function(b,c){var d,e,f,g,h;h=[];for(e=f=0,g=a.length;f<g;e=++f)d=a[e],d.event===b&&d.callback()===c()?h.push(a.slice(e,0)):h.push(void 0);return h},b}(),__t("navi").Page=function(){function b(b){this.out=a(this.out,this),this["in"]=a(this["in"],this),this.target=b.target,this.route=b.route,this.object=b.page}return b.prototype.removing=!1,b.prototype.animating_in=!1,b.prototype.animating_out=!1,b.prototype["in"]=function(a,b){var c=this;return this.animating_in=!0,this.el=this.object.render(a),$(this.target).html(this.el),this.object["in"](function(){if(c.removing===!1)return c.animating_in=!1,b()})},b.prototype.out=function(a){var b=this;return this.animating_out=!0,this.removing=!0,this.animating_in=!1,this.object.out(function(){return b.animating_out=!1,a()})},b}(),__t("navi").Main=function(){function d(){}var a,b,c;return c=[],d.events=new navi.PubSub,a=null,b=null,d.map=function(a,b,d){var e,f=this;return e=new navi.Page({route:a,page:b,target:d,params:null}),c.push(e),window.page("/#"+a,function(a){return e.params=a.params,f.process_hash_change(e)})},d.init=function(){var a;return a=window.location.hash.toString().substring(1),window.page("/#"+a)},d.has_valid_hash=function(){var a;return a=window.location.hash.toString().substring(1),this.get_page(a)?!0:!1},d.go=function(a){return window.page("/#"+a)},d.process_hash_change=function(a){return d.events.trigger("route_change"),d.change_page(a)},d.change_page=function(a){var b=this;return this.next_page=a.route,this.current_page?this.remove_current_page(function(){return b.add_next_page(a)}):this.add_next_page(a)},d.remove_current_page=function(a){if(this.current_page.animating_in){if(this.current_page.animating_out===!1)return this.current_page.out(a)}else if(this.current_page.animating_out===!1)return this.current_page.out(a)},d.add_next_page=function(a){return console.log(a.params),this.current_page=this.get_page(this.next_page),d.events.trigger("page_change"),this.current_page["in"](a.params,function(){})},d.get_page=function(a){var b,d,e;for(d=0,e=c.length;d<e;d++){b=c[d];if(b.route===a)return b}},d}.call(this),typeof define=="function"&&define.amd?define(function(){return navi.Main}):"undefined"==typeof module?window.Navi=navi.Main:(exports.map=function(a,b,c){return navi.Main.map(a,b,c)},exports.go=function(a){return navi.Main.go(a)},exports.init=function(){return navi.Main.init()},exports.bind=function(a,b){return navi.Main.events.bind(a,b)},exports.unbind=function(a,b){return navi.Main.events.unbind(a,b)})})).call(this)
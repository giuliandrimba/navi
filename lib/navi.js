(function(a,b,c){function j(a){return a=a||location.href,"#"+a.replace(/^[^#]*#?(.*)$/,"$1")}var d="hashchange",e=document,f,g=a.event.special,h=e.documentMode,i="on"+d in b&&(h===c||h>7);a.fn[d]=function(a){return a?this.bind(d,a):this.trigger(d)},a.fn[d].delay=50,g[d]=a.extend(g[d],{setup:function(){if(i)return!1;a(f.start)},teardown:function(){if(i)return!1;a(f.stop)}}),f=function(){function n(){var c=j(),e=m(h);c!==h?(l(h=c,e),a(b).trigger(d)):e!==h&&(location.href=location.href.replace(/#.*/,"")+e),g=setTimeout(n,a.fn[d].delay)}var f={},g,h=j(),k=function(a){return a},l=k,m=k;return f.start=function(){g||n()},f.stop=function(){g&&clearTimeout(g),g=c},a.browser.msie&&!i&&function(){var b,c;f.start=function(){b||(c=a.fn[d].src,c=c&&c+j(),b=a('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){c||l(j()),n()}).attr("src",c||"javascript:0").insertAfter("body")[0].contentWindow,e.onpropertychange=function(){try{event.propertyName==="title"&&(b.document.title=e.title)}catch(a){}})},f.stop=k,m=function(){return j(b.location.href)},l=function(c,f){var g=b.document,h=a.fn[d].domain;c!==f&&(g.title=e.title,g.open(),h&&g.write('<script>document.domain="'+h+'"</script>'),g.close(),b.location.hash=c)}}(),f}()})(jQuery,this);var __t;__t=function(ns){var curr,index,part,parts,_i,_len;curr=null,parts=[].concat=ns.split(".");for(index=_i=0,_len=parts.length;_i<_len;index=++_i){part=parts[index];if(curr===null){curr=eval(part);continue}curr[part]==null?curr=curr[part]={}:curr=curr[part]}return curr};var navi={};((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=this;__t("navi").PubSub=function(){function b(){}var a;return a=[],b.prototype.bind=function(b,c){return a.push({event:b,callback:c})},b.prototype.trigger=function(b,c){var d,e,f,g;g=[];for(e=0,f=a.length;e<f;e++)d=a[e],d.event===b?g.push(d.callback(c)):g.push(void 0);return g},b.prototype.unbind=function(b,c){var d,e,f,g,h;h=[];for(e=f=0,g=a.length;f<g;e=++f)d=a[e],d.event===b&&d.callback()===c()?h.push(a.slice(e,0)):h.push(void 0);return h},b}(),__t("navi").Page=function(){function b(b){this.outro=a(this.outro,this),this.intro=a(this.intro,this),this.target=b.target,this.route=b.route,this.object=b.page}return b.prototype.removing=!1,b.prototype.animating_in=!1,b.prototype.animating_out=!1,b.prototype.intro=function(a,b){var c=this;return this.animating_in=!0,this.el=this.object.render(a),$(this.target).html(this.el),this.object.intro(function(){b();if(c.removing===!1)return c.animating_in=!1})},b.prototype.outro=function(a){var b=this;return this.animating_out=!0,this.removing=!0,this.animating_in=!1,this.object.outro(function(){return b.animating_out=!1,a()})},b}(),__t("navi").HashNav=function(){function a(){var a=this;return this.states=[],$(window).hashchange(function(b){return a.change_route(window.location.hash.toString())}),function(b,c){return c&&a.states.push({hash:b,callback:c,regexp:a.format_hash(b)}),c&&b.length>1||(window.location.hash="/"+b),a}}return a.prototype.format_hash=function(a){var b,c;return b=/(:[^\/]*)/g,c=a.replace(/(:[^\/]*)/g,"(.*)"),b=new RegExp(c,"g"),b},a.prototype.change_route=function(a){var b,c,d,e,f;a=a.substring(2),e=this.states,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],b.regexp.test(a)?a.match(b.regexp)[0]===a?f.push(b.callback({params:a})):f.push(void 0):f.push(void 0);return f},a.prototype.init=function(){return this.change_route(window.location.hash.toString())},a}(),__t("navi").Main=function(){function d(){}var a,b,c;return c=[],d.events=new navi.PubSub,a=null,b=null,d.prototype.locked=!1,d.map=function(a,b,d){var e,f,g=this;return e=new navi.Page({route:a,page:b,target:d,params:null}),c.push(e),f=window.page(a,function(a){return e.params=a.params,g.process_hash_change(e)}),e.regexp=f.format_hash(e.route)},d.init=function(){var a;return a=window.location.hash.toString().substring(2),d.has_valid_hash(a)?window.page(a).init():window.page(c[0].route)},d.has_valid_hash=function(){var a;return a=window.location.hash.toString().substring(2),this.get_page(a)?!0:!1},d.go=function(a){if(!this.locked)return window.page(a)},d.process_hash_change=function(a){return d.events.trigger("route_change",{page:a.route}),d.change_page(a)},d.change_page=function(a){var b=this;return this.next_page=a.route,this.current_page?this.remove_current_page(function(){return b.add_next_page(a)}):this.add_next_page(a)},d.remove_current_page=function(a){if(this.current_page.animating_in){if(this.current_page.animating_out===!1)return this.current_page.outro(a)}else if(this.current_page.animating_out===!1)return this.current_page.outro(a)},d.add_next_page=function(a){var b=this;return this.current_page=this.get_page(this.next_page),this.current_page.intro(a.params,function(){return d.events.trigger("page_change")})},d.get_page=function(a){var b,d,e,f,g,h,i,j;console.log("get page"),d=null;for(f=0,h=c.length;f<h;f++){b=c[f];if(a.match(b.regexp)){j=a.match(b.regexp);for(g=0,i=j.length;g<i;g++)e=j[g],e===a&&(d=b)}}return d},d}.call(this),typeof define=="function"&&define.amd?define(function(){return window.page=new navi.HashNav,navi.Main}):"undefined"==typeof module?(window.page=new navi.HashNav,window.Navi=navi.Main):(exports.map=function(a,b,c){return navi.Main.map(a,b,c)},exports.go=function(a){return navi.Main.go(a)},exports.init=function(){return navi.Main.init()},exports.bind=function(a,b){return navi.Main.events.bind(a,b)},exports.unbind=function(a,b){return navi.Main.events.unbind(a,b)})})).call(this)